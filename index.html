<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9 Tiles</title>
    <link rel="stylesheet" href="style.css" />
    <script src="./algo.js"></script>
  </head>
  <body>
    <header>
      <h1>9 TILES</h1>
    </header>
    <main>
      <div>
        <button onclick="handleClickGenerateBoard()">↪️ Generate Board</button>
        <table id="board"></table>
      </div>
      <div id="options">
        <button onclick="handleClickAlgo(true)">Simple</button>
        <button onclick="handleClickAlgo(false)">Manhattan Distance</button>
      </div>
    </main>
  </body>
  <script>
    let isEditMode = true;

    // Initial board
    let board = [
      [1, 0, 2],
      [4, 5, 3],
      [7, 8, 6],
    ];

    // Goal board
    let goalBoard = [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8, 0],
    ];

    // UI
    plotBoard(board);

    function plotBoard(board, highlightCoord = null) {
      const table = document.getElementById("board");
      table.innerHTML = "";

      board.forEach((row, rowIndex) => {
        const tr = document.createElement("tr");

        row.forEach((cell, colIndex) => {
          const td = document.createElement("td");
          td.setAttribute("draggable", isEditMode);
          td.dataset.row = rowIndex;
          td.dataset.col = colIndex;

          td.textContent = cell === 0 ? "" : cell;

          if (
            highlightCoord &&
            rowIndex === highlightCoord[0] &&
            colIndex === highlightCoord[1]
          ) {
            td.classList.add("highlight");
          }

          if (isEditMode) {
            td.addEventListener("dragstart", handleDragStart);
            td.addEventListener("dragover", handleDragOver);
            td.addEventListener("dragleave", handleDragLeave);
            td.addEventListener("drop", handleDrop);
          }

          tr.appendChild(td);
        });

        table.appendChild(tr);
      });
    }

    let dragSrc = null;

    function handleDragStart(e) {
      dragSrc = this;
    }

    function handleDragOver(e) {
      e.preventDefault();
      this.classList.add("drag-over");
    }

    function handleDragLeave() {
      this.classList.remove("drag-over");
    }

    function handleDrop(e) {
      e.preventDefault();
      this.classList.remove("drag-over");

      if (!dragSrc || dragSrc === this) return;

      const fromRow = parseInt(dragSrc.dataset.row);
      const fromCol = parseInt(dragSrc.dataset.col);
      const toRow = parseInt(this.dataset.row);
      const toCol = parseInt(this.dataset.col);

      const temp = board[fromRow][fromCol];
      board[fromRow][fromCol] = board[toRow][toCol];
      board[toRow][toCol] = temp;

      plotBoard(board);
    }

    function handleClickAlgo(isSimple) {
      isEditMode = false;

      const boards = runSimpleAlgo(board, goalBoard, isSimple);
      let index = 0;

      console.log(boards);

      const interval = setInterval(() => {
        if (index >= boards.length) {
          clearInterval(interval);
          return;
        }

        const step = boards[index];
        plotBoard(step.board, step.zeroCoord);
        index++;
      }, 50);
    }

    function handleClickGenerateBoard() {
      const newBoard = generateSolvableBoard();
      board = newBoard;
      plotBoard(newBoard);
    }
  </script>
</html>
