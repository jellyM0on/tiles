<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9 Tiles</title>
  </head>
  <body>

    
  </body>
  <script>
    // Initial board
    let board = [
      [1, 0, 2],
      [4, 5, 3],
      [7, 8, 6],
    ];

    let goalBoard = [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8, 0],
    ];

    function generateRandomBoard() {
      let values = [0, 1, 2, 3, 4, 5, 6, 7, 8];
      let board = [];

      for (let i = 0; i < 3; i++) {
        board[i] = [];
        for (let j = 0; j < 3; j++) {
          const randomIndex = Math.floor(Math.random() * values.length);
          board[i][j] = values.splice(randomIndex, 1)[0];
        }
      }
      return board;
    }

    function runSA(board, goalBoard) {
      let boards = [board];
      let previousZeroCoord = null;
      let currentBoard = board;

      while (true) {
        let currentZeroCoord = findZero(currentBoard);
        let zeroNeighbors = getZeroNeighbors(
          currentZeroCoord,
          previousZeroCoord
        );

        let nextBoard = generateNextBoard(
          goalBoard,
          currentBoard,
          currentZeroCoord,
          zeroNeighbors
        );

        if (nextBoard) {
          boards.push(nextBoard.board);
        }

        if (!nextBoard || nextBoard.misplaced === 0) {
          break;
        }

        previousZeroCoord = currentZeroCoord;
        currentBoard = nextBoard.board;
      }

      return boards;
    }

    function findZero(board) {
      for (let x = 0; x < 3; x++) {
        for (let y = 0; y < 3; y++) {
          if (board[x][y] === 0) {
            return [x, y];
          }
        }
      }
    }

    function getZeroNeighbors([x, y], previousZeroCoord) {
      const potentialMoves = [
        [x - 1, y],
        [x + 1, y],
        [x, y - 1],
        [x, y + 1],
      ];

      return potentialMoves.filter(([nx, ny]) => {
        const isInBounds = nx >= 0 && nx < 3 && ny >= 0 && ny < 3;
        const isNotPrevious =
          previousZeroCoord === null ||
          nx !== previousZeroCoord[0] ||
          ny !== previousZeroCoord[1];
        return isInBounds && isNotPrevious;
      });
    }

    function generateNextBoard(
      goalBoard,
      board,
      currentZeroCoord,
      zeroNeighbors
    ) {
      const [x0, y0] = currentZeroCoord;

      let bestBoards = [];
      let bestScore = Infinity;

      for (const [nx, ny] of zeroNeighbors) {
        const newBoard = board.map((row) => row.slice());

        [newBoard[x0][y0], newBoard[nx][ny]] = [
          newBoard[nx][ny],
          newBoard[x0][y0],
        ];

        const misplacedCount = countMisplacedTiles(newBoard, goalBoard);

        if (misplacedCount < bestScore) {
          bestBoards = [newBoard];
          bestScore = misplacedCount;
        } else if (misplacedCount === bestScore) {
          bestBoards.push(newBoard);
        }
      }

      const chosenBoard =
        bestBoards[Math.floor(Math.random() * bestBoards.length)];

      return {
        board: chosenBoard,
        misplaced: bestScore,
      };
    }

    function countMisplacedTiles(currentBoard, goalBoard) {
      let count = 0;

      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          const currentVal = currentBoard[i][j];
          const goalVal = goalBoard[i][j];

          if (currentVal !== 0 && currentVal !== goalVal) {
            count++;
          }
        }
      }

      return count;
    }

    const testBoard = [
      [5, 1, 3],
      [4, 2, 8],
      [6, 7, 0],
    ];
    let test = runSA(testBoard, goalBoard);
    console.log(test);
  </script>
</html>
